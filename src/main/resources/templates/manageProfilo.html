<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Il mio Profilo - SiwRecipes</title>
    <link rel="stylesheet" href="/css/stile.css" />
    <link rel="stylesheet" href="/css/manageProfilo.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body>

    <header class="main-header">
        <div class="header-content-wrapper">
            <div class="header-left">
                <a th:href="@{/}" class="btn-gold">
                    <i class="fa-solid fa-house-chimney"></i> Home
                </a>
            </div>
            
            <div class="header-right">
               
                
				<div sec:authorize="isAuthenticated()" style="display:flex; align-items:center; gap:10px;">
				                <div th:if="${currentUser != null}" style="display: inline-block;">

				                    <span th:if="${currentUser.credentials != null && currentUser.credentials.ruolo == 'ADMIN'}" 
				                          class="chef-name" 
				                          style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 8px;">
				                           <i class="fa-solid fa-crown" style="color: #C5A059;"></i>
				                           <span th:text="${currentUser.nome} + ' ' + ${currentUser.cognome}">Admin</span>
				                    </span>

				                    <span th:if="${currentUser.credentials != null && currentUser.credentials.ruolo == 'DEFAULT'}" class="header-text">
				                        <i class="fa-solid fa-user"></i>
				                        <span th:text="|${currentUser.nome} ${currentUser.cognome}|">Nome Cognome</span>
				                    </span>

				                </div>
				                
				                <form th:action="@{/logout}" method="post" style="margin:0;">
				                    <button type="submit" class="btn-logout">
				                        Logout <i class="fa-solid fa-right-from-bracket"></i>
				                    </button>
				                </form>
				            </div>
            </div>
        </div>
    </header>
	
	<div class="logo-container">
	        <a th:href="@{/}">
	            <img src="/images/logo2 copia.PNG" class="main-logo" alt="SiwRecipe Logo" onerror="this.style.display='none'"/>
	        </a>  
	    </div>

    <div class="container">
		<div class="profile-header">
		        <h1 th:text="'Benvenuto, ' + ${currentUser.nome} + '!'">Benvenuto!</h1>
		        <p>Gestisci le tue ricette e i tuoi piatti preferiti.</p>
		        
				<div class="personal-info-container">
				    <div class="personal-info-card">
				        
				        <div class="info-card-header">
				            <i class="fa-solid fa-id-card"></i>
				            <h2>I tuoi Dati Personali</h2>
				        </div>

				        <div class="info-grid">
				            
				            <div class="info-item">
				                <span class="info-label">Nome</span>
				                <div class="info-value-wrapper">
				                    <i class="fa-solid fa-user"></i>
				                    <span class="info-value" th:text="${currentUser.nome}">Nome</span>
				                </div>
				            </div>

				            <div class="info-item">
				                <span class="info-label">Cognome</span>
				                <div class="info-value-wrapper">
				                    <i class="fa-solid fa-signature"></i>
				                    <span class="info-value" th:text="${currentUser.cognome}">Cognome</span>
				                </div>
				            </div>

				            <div class="info-item">
				                <span class="info-label">Email</span>
				                <div class="info-value-wrapper">
				                    <i class="fa-solid fa-envelope"></i>
				                    <span class="info-value" th:text="${currentUser.email}">email@esempio.it</span>
				                </div>
				            </div>

				            <div class="info-item">
				                <span class="info-label">Data di Nascita</span>
				                <div class="info-value-wrapper">
				                    <i class="fa-solid fa-cake-candles"></i>
				                    <span class="info-value" 
				                          th:text="${currentUser.dataDiNascita != null ? #temporals.format(currentUser.dataDiNascita, 'dd/MM/yyyy') : 'Non specificata'}">
				                          01/01/1990
				                    </span>
				                </div>
				            </div>

				        </div>
				    </div>
				</div>

		        <div class="actions-bar">
		            <a th:href="@{/formNewRicetta}" class="btn-add">
		                + Crea Nuova Ricetta
		            </a>
            </div>
        </div>
		<section>
    <div class="section-title">Le mie Ricette Caricate</div>
    
    <div th:if="${currentUser.ricetteScritte == null || currentUser.ricetteScritte.isEmpty()}" class="empty-state">
        <p>Non hai ancora scritto nessuna ricetta. Inizia ora!</p>
    </div>

    <div class="recipe-grid">
        <div th:each="ricetta : ${currentUser.ricetteScritte}" class="recipe-card">
            
            <a th:href="@{'/ricetta/' + ${ricetta.id}}">
                <div class="card-image-container">
                    <img th:src="${ricetta.imageUrl != null ? ricetta.imageUrl : '/images/default.jpg'}" alt="Foto Ricetta">
                </div>
            </a>
            
            <div class="card-content">
                <a th:href="@{'/ricetta/' + ${ricetta.id}}">
                    <h3 class="card-title" th:text="${ricetta.titolo}">Titolo</h3>
                </a>

                <div class="card-actions-wrapper" style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; padding-top: 10px;">
                    
                    <a th:href="@{'/ricetta/' + ${ricetta.id} + '/edit'}" class="btn-gold" style="text-decoration: none; font-size: 0.85em;">
                        <i class="fa-solid fa-pen-to-square"></i> Modifica
                    </a>

                    <form th:action="@{'/ricetta/delete/' + ${ricetta.id}}" method="post" 
                          onsubmit="return confirm('Sei sicuro di voler eliminare definitivamente questa ricetta?');" 
                          style="margin: 0;">
                        <button type="submit" class="btn-logout" style="font-size: 0.85em; border: none; cursor: pointer;">
                            <i class="fa-solid fa-trash-can"></i> Elimina
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

        <section>
            <div class="section-title">I miei Preferiti</div>
            <div th:if="${currentUser.ricetteSalvate == null || currentUser.ricetteSalvate.isEmpty()}" class="empty-state">
                <p>Non hai ancora salvato ricette nei preferiti.</p>
            </div>

            <div class="recipe-grid">
                <div th:each="fav : ${currentUser.ricetteSalvate}" class="recipe-card">
                    <div class="card-image-container" style="position: relative;">
                        <div class="favorite-action">
                            <form th:action="@{/ricetta/{id}/preferiti/rimuovi(id=${fav.id}, redirect='profile')}" method="post">
                                <button type="submit" class="btn-favorite" title="Rimuovi dai preferiti"
                                        style="background: none; border: none; cursor: pointer; position: absolute; top: 10px; left: 10px; z-index: 10;">
                                    <i class="fa-solid fa-heart" style="color: #ff3b3b; font-size: 1.5em;"></i>
                                </button>
                            </form>
                        </div>
                        <a th:href="@{'/ricetta/' + ${fav.id}}">
                            <img th:src="${fav.imageUrl != null ? fav.imageUrl : '/images/default.jpg'}" alt="Foto Preferita">
                        </a>
                    </div>
                    
                    <div class="card-content">
                        <a th:href="@{'/ricetta/' + ${fav.id}}">
                            <h3 class="card-title" th:text="${fav.titolo}">Titolo</h3>
                        </a>
                        <p class="card-author">Di: <span th:text="${fav.autore.nome} + ' ' + ${fav.autore.cognome}">Chef</span></p>
                    </div>
                </div> 
            </div>
        </section>
    </div>
</body>
</html>